{% load static %}
<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
    integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
    crossorigin="anonymous" referrerpolicy="no-referrer" />
  <title>Anvestors</title>
  <style>
    body {
      background-color: #000;
      color: #FFD700;
      font-family: 'Poppins', sans-serif;
      overflow-x: hidden;
      text-align: center;
    }

    .navbar-custom {
      background-color: #000;
      padding: 10px 20px;
      box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      height: 100px;
    }

    .navbar-custom .navbar-brand,
    .navbar-custom .navbar-nav .nav-link {
      color: #FFD700;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    .navbar-custom .navbar-nav .nav-link i {
      font-size: 24px;
      color: #FFD700;
    }

    .navbar-custom .navbar-nav .nav-link:hover,
    .navbar-custom .nav-item.active .nav-link {
      color: #FFD700;
      background-color: #333;
      border-radius: 5px;
    }

    .card-custom {
      margin-top: 20px;
      background-color: #222;
      color: #FFD700;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    .card-custom:hover {
      transform: translateY(-5px);
      box-shadow: 0px 10px 20px rgba(0, 0, 0, 0.5);
    }

    .card-custom .card-header,
    .card-custom .card-footer {
      background-color: #000000;
      color: #FFD700;
      border: none;
      box-shadow: 0px 2px 5px rgba(0, 0, 0, 0.3);
    }

    .card {
      background-color: #000;
    }

    .table {
      width: 100%;
      margin-bottom: 1rem;
      color: #FFD700;
      font-size: larger;
    }

    .power-button {
      width: 60px;
      height: 60px;
      background-color: #FFD700;
      border: none;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      justify-content: center;
      align-items: center;
      position: fixed;
      margin-right: 10px;
      left: 80%;
      bottom: 100px;
      transition: all 0.3s ease;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.3);
    }

    .power-button.on {
      background-color: #FFD700;
      animation: pulse 1s infinite;
      box-shadow: 0 0 15px #FFD700, 0px 5px 15px rgba(0, 0, 0, 0.3);
    }

    .power-button i {
      color: #000;
      font-size: 32px;
    }

    .power-button-text {
      font-size: 25px;
      color: #FFD700;
      margin-left: 10px;
      font-weight: bold;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
    }

    @keyframes pulse {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }

    .modal-content {
      background-color: #000;
      color: #FFD700;
      border: none;
      box-shadow: 0px 5px 15px rgba(0, 0, 0, 0.5);
    }

    .modal-header .close {
      color: #FFD700;
    }

    .sidebar-bottom {
      position: fixed;
      right: 0;
      top: 50%;
      transform: translateY(-50%);
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      z-index: 1000;
    }

    .sidebar-bottom-container {
      display: flex;
      align-items: center;
      margin: 10px 0;
      padding: 10px 20px;
      width: 50px;
      background-color: #222;
      color: #FFD700;
      text-align: center;
      text-decoration: none;
      border-radius: 10px 0 0 10px;
      transition: width 0.3s ease;
      overflow: hidden;
      white-space: nowrap;
      box-shadow: 0 0 15px rgba(0, 0, 0, 0.3);
    }

    .sidebar-bottom-container:hover {
      width: 150px;
      background-color: #FFD700;
      color: #000;
    }

    .sidebar-bottom-container i {
      display: inline-block;
      font-size: 20px;
      margin-right: 10px;
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
    }

    .sidebar-bottom-container span {
      font-size: smaller;
      display: inline-block;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .sidebar-bottom-container:hover span {
      opacity: 1;
    }

    .sidebar-bottom-container#dashboard {
      background-color: #333;
    }

    .sidebar-bottom-container#signals {
      background-color: #444;
    }

    .sidebar-bottom-container#trade-history {
      background-color: #555;
    }

    .sidebar-bottom-container#trade-status {
      background-color: #666;
    }

    .sidebar-bottom-container#help-center {
      background-color: #777;
    }

    .sidebar-bottom-container#home {
      background-color: #999;
    }

    .sidebar-bottom-container#dashboard:hover {
      background-color: #FFD700;
      color: #000;
    }

    .sidebar-bottom-container#signals:hover {
      background-color: #FFD700;
      color: #000;
    }

    .sidebar-bottom-container#trade-history:hover {
      background-color: #FFD700;
      color: #000;
    }

    .sidebar-bottom-container#trade-status:hover {
      background-color: #FFD700;
      color: #000;
    }

    .sidebar-bottom-container#help-center:hover {
      background-color: #FFD700;
      color: #000;
    }

    .sidebar-bottom-container#home:hover {
      background-color: #FFD700;
      color: #000;
    }

    .button {
      text-decoration: none;
      position: relative;
      border: none;
      font-size: 14px;
      font-family: inherit;
      cursor: pointer;
      color: #fff;
      width: 9em;
      height: 3em;
      line-height: 2em;
      text-align: center;
      background: linear-gradient(90deg, #03a9f4, #f441a5, #ffeb3b, #03a9f4);
      background-size: 300%;
      border-radius: 30px;
      z-index: 1;
      filter: grayscale(100%);
      transition: filter 0.3s ease;
    }

    .button.on {
      filter: none;
    }

    .button:hover {
      animation: ani 8s linear infinite;
      border: none;
    }

    @keyframes ani {
      0% {
        background-position: 0%;
      }

      100% {
        background-position: 400%;
      }
    }

    .button:before {
      content: "";
      position: absolute;
      top: -5px;
      left: -5px;
      right: -5px;
      bottom: -5px;
      z-index: -1;
      background: linear-gradient(90deg, #03a9f4, #f441a5, #ffeb3b, #03a9f4);
      background-size: 400%;
      border-radius: 35px;
      transition: 1s;
    }

    .button:hover::before {
      filter: blur(20px);
    }

    .button:active {
      background: linear-gradient(32deg, #03a9f4, #f441a5, #ffeb3b, #03a9f4);
    }

    .container-fluid {
      padding-bottom: 60px;
    }

    @media (max-width: 768px) {
      .power-button-text {
        display: none;
      }

      .power-button {
        left: 70%;
      }

      .sidebar-bottom {
        flex-direction: row;
        bottom: 0;
        top: auto;
        right: 0;
        left: 0;
        transform: none;
        border-radius: 0;
        width: 100%;
        justify-content: space-around;
        padding: 10px 0;
      }

      .sidebar-bottom-container {
        width: 50px;
        margin: 0;
        padding: 10px 5px;
        border-radius: 0;
      }

      .sidebar-bottom-container span {
        display: none;
      }
    }

    .table-bordered td,
    .table-bordered th {
      border: 1px solid #FFD700;
    }

    .list-group-item-warning.list-group-item-action.active {
      color: #000;
      background-color: #FFD700;
      border-color: #FFD700;
    }

    a {
      color: #FFD700;
      text-decoration: none;
      background-color: transparent;
    }

    .fade-in {
      animation: fadeIn 2s;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .glow {
      text-shadow: 0 0 10px #FFD700, 0 0 20px #FFD700, 0 0 30px #FFD700, 0 0 40px #FFD700;
    }

    .pulse-button {
      animation: pulseButton 1s infinite;
    }

    @keyframes pulseButton {
      0% {
        transform: scale(1);
      }

      50% {
        transform: scale(1.1);
      }

      100% {
        transform: scale(1);
      }
    }

    .notification-popup {
      position: absolute;
      top: 70px;
      right: 20px;
      width: 300px;
      background-color: #000;
      border: 1px solid #FFD700;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.5);
      display: none;
      z-index: 1000;
      animation: slideIn 0.5s ease-out;
    }

    .notification-popup .popup-header {
      padding: 10px;
      background-color: #FFD700;
      color: #000;
      font-weight: bold;
      text-align: center;
      border-top-left-radius: 5px;
      border-top-right-radius: 5px;
    }

    .notification-popup .popup-body {
      padding: 10px;
      max-height: 300px;
      overflow-y: auto;
    }

    .notification-popup .popup-body p {
      margin: 0;
      padding: 10px;
      border-bottom: 1px solid #FFD700;
      transition: background-color 0.3s ease;
    }

    .notification-popup .popup-body p:last-child {
      border-bottom: none;
    }

    .notification-popup .popup-body p:hover {
      background-color: #333;
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    /* Sliding panel CSS */
    .profile-slide {
      position: fixed;
      top: 0;
      right: -100%;
      width: 50%;
      height: 100%;
      background-color: #1e1e1e;
      color: #FFD700;
      box-shadow: -2px 0 10px rgba(0, 0, 0, 0.5);
      z-index: 1050;
      transition: right 0.3s ease;
      overflow-y: auto;
    }

    .profile-slide.open {
      right: 0;
    }

    .profile-slide .close-slide {
      position: absolute;
      top: 20px;
      right: 20px;
      font-size: 24px;
      cursor: pointer;
      color: #FFD700;
    }

    .profile-slide .profile-content {
      padding: 30px;
    }

    .profile-slide .profile-content h5 {
      font-size: 24px;
      margin-bottom: 20px;
      text-align: center;
      border-bottom: 1px solid #FFD700;
      padding-bottom: 10px;
    }

    .profile-slide .profile-content p {
      font-size: 18px;
      margin-bottom: 15px;
    }

    .profile-slide .profile-content .btn {
      display: block;
      width: 100%;
      margin-bottom: 15px;
      border-radius: 50px;
      font-size: 18px;
    }

    .profile-slide .profile-content .btn-warning {
      background-color: #FFD700;
      color: #000;
      border: none;
      transition: background-color 0.3s;
    }

    .profile-slide .profile-content .btn-warning:hover {
      background-color: #e6c200;
    }

    .profile-slide .profile-content .btn-danger {
      background-color: #d9534f;
      color: #fff;
      border: none;
      transition: background-color 0.3s;
    }

    .profile-slide .profile-content .btn-danger:hover {
      background-color: #c9302c;
    }

  </style>
</head>

<body style="height: 100%;">

  <div class="container-fluid">
    <div class="row">
      <div class="col-sm-12 p-2">
        <div class="container-fluid p-2">
          <nav class="navbar navbar-expand-lg navbar-light navbar-custom">
            <img src="{% static 'xyz.jpeg' %}" width="300" height="60">
            <div class="ml-auto d-flex align-items-center">
              <a class="nav-link" href="#" id="notificationIcon"><i class="fa-solid fa-bell"></i></a>
              <a class="nav-link" href="#" id="profileIcon"><i class="fa-solid fa-user-circle"></i></a>
              <div class="button-1 ml-3">
                <button class="button" id="brokerConnectButton">
                  <span>Broker Connect</span>
                </button>
              </div>
            </div>
          </nav>
          <!-- Notification Popup -->
          <div class="notification-popup" id="notificationPopup">
            <div class="popup-header">Notifications</div>
            <div class="popup-body" id="notificationBody">
              <p>No new notifications.</p>
            </div>
          </div>
          <!-- TradingView Widget BEGIN -->
          <div class="tradingview-widget-container">
            <div class="tradingview-widget-container__widget"></div>
            <div class="tradingview-widget-copyright">
              <a href="https://in.tradingview.com/" rel="noopener nofollow" target="_blank">
              </a>
            </div>
            <script type="text/javascript" src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js" async>
              {
                "symbols": [
                  {
                    "description": "",
                    "proName": "BSE:SENSEX"
                  },
                  {
                    "description": "",
                    "proName": "AMEX:SPY"
                  },
                  {
                    "description": "",
                    "proName": "BIST:XAUUSD1!"
                  },
                  {
                    "description": "",
                    "proName": "TVC:USOIL"
                  },
                  {
                    "description": "",
                    "proName": "LSE:NASD"
                  }
                ],
                "showSymbolLogo": true,
                "isTransparent": false,
                "displayMode": "adaptive",
                "colorTheme": "dark",
                "locale": "in"
              }
            </script>
           </div>
          <!-- TradingView Widget END -->
          <div class="card shadow card-custom fade-in" style="min-height: 89vh">
            <div class="card-body">
              {% block main %}
              {% endblock %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="sidebar-bottom">
    <div id="dashboard" class="sidebar-bottom-container">
      <a href="{% url 'client_dashbord' %}" class="{% if request.path == '/dashbord/' %} active {% endif %}">
        <i class="fa-solid fa-sliders-h"></i>
        <span>CONTROL PANEL</span>
      </a>
    </div>
    <div id="signals" class="sidebar-bottom-container">
      <a href="{% url 'trade_list' %}" class="{% if request.path == '/trade_list/' %} active {% endif %}">
        <i class="fa-solid fa-signal"></i>
        <span>Levels</span>
      </a>
    </div>
    <div id="trade-history" class="sidebar-bottom-container">
      <a href="{% url 'client_trade_history' %}" class="{% if request.path == '/client_trade_history/' %} active {% endif %}">
        <i class="fa-solid fa-history"></i>
        <span>P&L Account</span>
      </a>
    </div>
    <div id="trade-status" class="sidebar-bottom-container">
      <a href="{% url 'client_status' %}" class="{% if request.path == '/tradingstatus/' %} active {% endif %}">
        <i class="fa-solid fa-chart-line"></i>
        <span>Activity</span>
      </a>
    </div>
    <div id="help-center" class="sidebar-bottom-container">
      <a href="{% url 'client_help_center' %}" class="{% if request.path == '/client_help_center/' %} active {% endif %}">
        <i class="fa-solid fa-headset"></i>
        <span>Support</span>
      </a>
    </div>
    <div id="home" class="sidebar-bottom-container">
      <a href="{% url 'homes' %}" class="{% if request.path == '/homes/' %} active {% endif %}">
        <i class="fa-solid fa-home"></i>
        <span>Home</span>
      </a>
    </div>
  </div>

  <!-- Sliding Profile Panel -->
  <div class="profile-slide" id="profileSlide">
    <span class="close-slide" id="closeSlide">&times;</span>
    <div class="profile-content">
      <h5 class="modal-title">Profile</h5>
      <p><strong>Name:</strong> {{ client_user.clint_name_first }} {{client_user.clint_name_last}}</p>
      <p><strong>Email:</strong> {{ client_user.clint_email }}</p>
      <p><strong>Mobile:</strong> {{ client_user.clint_phone_number }}</p>
      <p><strong>Broker:</strong> {{ client_user.broker }}</p>
      <p><strong>API Key:</strong> {{ client_user.api_key }}</p>
      <a href="#" class="btn btn-warning">Change Password</a>
      <a href="{% url 'client_logout' %}" class="btn btn-danger">Logout</a>
    </div>
  </div>

  <!-- Include jQuery and Bootstrap JavaScript in the correct order -->
  <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-ho+j7jyWK8fNQe+AiZK9Ll7/2hb7U6ka5c2e1uP4hL9F/l/71N1UnK27+q2MfRTO" crossorigin="anonymous"></script>
  <script>
    document.addEventListener('DOMContentLoaded', (event) => {
      const button = document.getElementById('brokerConnectButton');
      
      // Check the state of the button from local storage
      if (localStorage.getItem('apiConnect') === 'on') {
        button.classList.add('on');
      } else {
        button.classList.remove('on');
      }

      button.addEventListener('click', function () {
        button.classList.remove('on'); // Remove animation before redirect
        if (localStorage.getItem('apiConnect') === 'on') {
          localStorage.setItem('apiConnect', 'off');
          window.location.href = "{% url 'off' %}";
        } else {
          localStorage.setItem('apiConnect', 'on');
          window.location.href = "{% url 'redirect_to_smartapi_login' %}";
        }
      });

      // Listen for storage changes to update the button state
      window.addEventListener('storage', function () {
        if (localStorage.getItem('apiConnect') === 'on') {
          button.classList.add('on');
        } else {
          button.classList.remove('on');
        }
      });

      const notificationIcon = document.getElementById('notificationIcon');
      const notificationPopup = document.getElementById('notificationPopup');
      const notificationBody = document.getElementById('notificationBody');

      notificationIcon.addEventListener('click', function () {
        notificationPopup.style.display = notificationPopup.style.display === 'block' ? 'none' : 'block';
        if (notificationPopup.style.display === 'block') {
          fetchNotifications();
        }
      });

      function fetchNotifications() {
        fetch('/get-notifications/')
          .then(response => response.json())
          .then(data => {
            notificationBody.innerHTML = '';
            data.forEach(notification => {
              const p = document.createElement('p');
              p.textContent = `${notification.message} - ${new Date(notification.created_at).toLocaleString()}`;
              notificationBody.appendChild(p);
            });
          });
      }

      // Close the popup when clicking outside
      document.addEventListener('click', function (event) {
        if (!notificationIcon.contains(event.target) && !notificationPopup.contains(event.target)) {
          notificationPopup.style.display = 'none';
        }
      });

      // Handle profile slide
      const profileIcon = document.getElementById('profileIcon');
      const profileSlide = document.getElementById('profileSlide');
      const closeSlide = document.getElementById('closeSlide');

      profileIcon.addEventListener('click', function () {
        profileSlide.classList.add('open');
      });

      closeSlide.addEventListener('click', function () {
        profileSlide.classList.remove('open');
      });

      // Close the profile slide when clicking outside
      document.addEventListener('click', function (event) {
        if (!profileIcon.contains(event.target) && !profileSlide.contains(event.target)) {
          profileSlide.classList.remove('open');
        }
      });
    });
  </script>
</body>

</html>
